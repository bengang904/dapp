<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>去中心化存储 - 文件下载</title>
    <style>
        /* Google Style Variables */
        :root {
            --google-blue: #1a73e8;
            --google-blue-dark: #176ad2;
            --surface-color: #ffffff;
            --background-color: #f8f9fa;
            --text-color: #3c4043;
            --text-secondary: #5f6368;
            --shadow-elevation: 0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 1px 2px 0 rgba(60, 64, 67, 0.15);
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--background-color);
            color: var(--text-color);
            margin: 0;
        }
        
        /* Material Design Card */
        .card {
            background: var(--surface-color);
            padding: 2.5rem;
            border-radius: 8px; /* 适度的圆角 */
            box-shadow: var(--shadow-elevation); /* Google 风格的微妙阴影 */
            text-align: center;
            width: 90%;
            max-width: 440px;
            transition: box-shadow 0.3s ease;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--text-color);
            margin-top: 0;
        }

        p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Material Design Button */
        button {
            background: var(--google-blue);
            color: var(--surface-color);
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500; /* Medium weight */
            border-radius: 4px; /* 较小的圆角 */
            cursor: pointer;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);
            transition: background 0.2s ease, box-shadow 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Material Ripple Effect (Simple Hover) */
        button:hover {
            background: var(--google-blue-dark);
            box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        /* Progress Bar Container */
        .progress-container {
            width: 100%;
            background: #e8e8e8; /* 浅灰色背景 */
            border-radius: 9999px;
            overflow: hidden;
            margin-top: 1.5rem;
            height: 8px; /* 细进度条 */
            display: none;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 100%;
            width: 0%;
            background: var(--google-blue);
            transition: width 0.2s ease;
        }
        
        /* Percentage Text */
        .percent {
            margin-top: 0.75rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 400;
        }
    </style>
</head>
<body>
    <div class="card">
        <h2>VMware Workstation</h2>
        <p>文件名称: VMware-workstation-full-17.6.3-24583834.exe</p>
        <button id="download-btn" onclick="downloadFile()">下载文件</button>
        
        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>
        <div class="percent"></div>
    </div>

    <script>
        const FILE_URL = "https://g8way.io/s06ZfW-0oksXxKM2jiKCGSyXmW0Ge3afywp-xir6Qjs";
        const FILE_NAME = "VMware-workstation-full-17.6.3-24583834.exe";

        async function downloadFile() {
            const button = document.getElementById("download-btn");
            const progressContainer = document.querySelector(".progress-container");
            const progressBar = document.querySelector(".progress-bar");
            const percentText = document.querySelector(".percent");

            // UI 状态切换：隐藏按钮，显示进度条
            button.style.display = "none";
            progressContainer.style.display = "block";
            percentText.textContent = "正在连接服务器...";

            try {
                const response = await fetch(FILE_URL);
                if (!response.ok) throw new Error(`HTTP 错误: ${response.status}`);

                const contentLength = response.headers.get("Content-Length");
                const total = contentLength ? parseInt(contentLength, 10) : null;

                const reader = response.body.getReader();
                const chunks = [];
                let loaded = 0;

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    chunks.push(value);
                    loaded += value.length;
                    
                    if (total) {
                        const percent = ((loaded / total) * 100).toFixed(1);
                        progressBar.style.width = percent + "%";
                        percentText.textContent = `下载中... ${percent}%`;
                    } else {
                        // 如果没有 Content-Length 头部，显示已下载大小 (MB)
                        percentText.textContent = `下载中... ${(loaded / 1024 / 1024).toFixed(2)} MB`;
                    }
                }

                // 准备文件供用户下载
                const blob = new Blob(chunks);
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = FILE_NAME;
                
                // 触发下载
                a.click();
                
                // 释放内存
                URL.revokeObjectURL(a.href);

                progressBar.style.width = "100%";
                percentText.textContent = "✅ 下载开始！请检查您的下载文件夹。";
            } catch (err) {
                // 错误处理
                percentText.textContent = `❌ 下载失败: ${err.message}`;
                progressBar.style.width = "0%";
            } finally {
                // 2秒后恢复按钮状态
                setTimeout(() => {
                    progressContainer.style.display = "none";
                    button.style.display = "inline-block";
                    percentText.textContent = "";
                }, 2000);
            }
        }
    </script>
</body>
</html>